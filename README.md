# cloudflare-event-proxy
Example Cloudflare Worker that serves as an event proxy for detecting and redacting sensitive data
> Disclaimer: This is a proof-of-concept, and not intended to be deployed into a production environment as is.

![data flow diagram](https://private-user-images.githubusercontent.com/2018204/290591169-64cefb66-28b0-4f9e-adb6-d4d4cc31f36f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTEiLCJleHAiOjE3MDI1NzI5MjEsIm5iZiI6MTcwMjU3MjYyMSwicGF0aCI6Ii8yMDE4MjA0LzI5MDU5MTE2OS02NGNlZmI2Ni0yOGIwLTRmOWUtYWRiNi1kNGQ0Y2MzMWYzNmYucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQUlXTkpZQVg0Q1NWRUg1M0ElMkYyMDIzMTIxNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyMzEyMTRUMTY1MDIxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ODg0NTJlMmVhZTM5NWIwYmIzYzY1NDU5MGFhZDM1MGJiNzE0NzJiMDY0NGMwZDBjMTgwNzBkNzlhYmVhNTA5NSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.JXN8LbGrpvbSa2_N3B8m2I5DzxHlSdVjfQlUyrxynZg)

### How this works
1. Configure a Cloudflare Worker using this source code
2. Point any Statsig SDK (client or server) at this proxy by overriding `api` within `Initialize Options` ([docs](https://docs.statsig.com/client/jsClientSDK#statsig-options))
3. All SDK requests will be transmitted through proxy to Statsig (route handlers [here](src/index.js#L140))
4. Proxy will deserialize payload, detect & redact any sensitive data, and then forward requests to Statsig

### Demo
Test this locally by running `wrangler dev` and visiting `http://localhost:8787/`
![page](https://private-user-images.githubusercontent.com/2018204/290602893-5e736384-8125-4665-959c-31f4e5b93868.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTEiLCJleHAiOjE3MDI1NzQ2NjYsIm5iZiI6MTcwMjU3NDM2NiwicGF0aCI6Ii8yMDE4MjA0LzI5MDYwMjg5My01ZTczNjM4NC04MTI1LTQ2NjUtOTU5Yy0zMWY0ZTViOTM4NjgucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQUlXTkpZQVg0Q1NWRUg1M0ElMkYyMDIzMTIxNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyMzEyMTRUMTcxOTI2WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ODE3Yzc4OTcwZmRlY2YwZWUzMDJkNTllZjM2NmZjZTI5YmQ1NWFjNjAwODY1YzNiNmRlNjk4YzA1MzE3NTE2YSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.FZWHvFRavRRhXJ0fHxe2alynnJUoLoU_GaYAwbeXLiE)

Here is what you can expect to see in [Statsig livestream](https://docs.statsig.com/guides/logging-events#where-do-these-events-end-up)
![usage](https://private-user-images.githubusercontent.com/2018204/290601539-5aea7754-5e94-4ce7-b284-c2d67c01f550.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTEiLCJleHAiOjE3MDI1NzQ0NjIsIm5iZiI6MTcwMjU3NDE2MiwicGF0aCI6Ii8yMDE4MjA0LzI5MDYwMTUzOS01YWVhNzc1NC01ZTk0LTRjZTctYjI4NC1jMmQ2N2MwMWY1NTAucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQUlXTkpZQVg0Q1NWRUg1M0ElMkYyMDIzMTIxNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyMzEyMTRUMTcxNjAyWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MzFlMTgyZjFiYjVmYjRlMzA4MjMzMjAxNDE2ZmQ0MzJjZGU0N2RlZGU3YTE5OGM0ZjRmODlhNGU1NDhiYTFmNiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.I9g93JN7D61RD_nKhDRKaxjcZKZiWMjlBEBovhxJCz8)
   
### Customizing
- Enhance the sensitive data detection in source [here](src/sensitive.js)
- Determine if you want to _only_ override events endpoints 
